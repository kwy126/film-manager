<!DOCTYPE html> <!-- html定义 -->
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8"> <!-- 页面编码 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge"> <!-- 在IE运行最新的渲染模式 -->
    <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- 初始化移动浏览器显示 -->
    <title>收录电影管理界面</title>

    <!-- Bootstrap -->
    <link href="../webapp/static/css/bootstrap.css" rel="stylesheet"> <!-- 载入Bootstrap的CSS样式 -->
    <link href="../webapp/static/css/bootstrap-dialog.min.css" rel="stylesheet"/>
    <link href="../webapp/static/css/common.css" rel="stylesheet"/>
    <style>
        .img-height{
            height:160px;
        }

    </style>
</head>

<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href=index.html>
                <img alt="Brand" src="../webapp/static/image/logo.png" class="img-responsive img-circle" style="width:50px;height: 50px;">
            </a>
        </div>
        <div class="container">
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"  style="color:white">
                <ul class="nav navbar-nav navbar-list"></ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="javascript:void(0)" class="acctInfo hide"><span class="glyphicon glyphicon-user"></span>&nbsp;
                    </a></li>
                    <li><a href="javascript:void(0)" onclick="exit()">注销</a></li>
                </ul>
            </div>

        </div>

    </div><!-- /.container-fluid -->
</nav>

<div class="container main main-container" style="padding-top:70px;">
    <div class="row">
        <div class="container breadcrumb-container ">
            <ol class="breadcrumb"></ol>
        </div>
        <div class="col-md-6">

            <div class="input-group">
                <input type="text" class="form-control text-search" placeholder="请输入搜索内容...">
                <div class="input-group-btn">
                    <button type="button" class="btn btn-primary btn-search"><span
                            class="glyphicon glyphicon-search"></span>搜索
                    </button>
                </div><!-- /btn-group -->
            </div><!-- /input-group -->


        </div>
        <div class="col-md-6 text-align-right">
            <button type="button" class="btn btn-primary add-btn" data-toggle="modal" data-target="#add-web-site"><span
                    class="glyphicon glyphicon-plus"></span>&nbsp;新增链接
            </button>
        </div>
    </div>

    <table class="table table-bordered table-hover table-responsive" style="margin-top:20px;">
        <thead>
        <th style="width:10%;">编号</th>
        <th style="width:20%;">电影网站名称</th>
        <th style="width:50%;">电影网站地址</th>
        <th style="width:20%;">操作</th>
        </thead>
        <tbody class="tbody-list"></tbody>
    </table>
    <!-- 分页-->
    <nav id="pagination">
        <ul class="pagination"></ul>
    </nav>


</div>

<div class="modal fade add-box sm-modal" id="add-web-site">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header modal-header-primary"><h4 class="modal-title">添加收录电影网址信息</h4></div>
            <div class="modal-body">
                <form id="addForm" method="post" class="form-horizontal">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">电影网站名称：</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control name" placeholder="链接名称" maxlength="64" value=""/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">电影网站地址：</label>
                        <div class="col-sm-9">
                             <input type="text" class="form-control margin-top-15 url"  maxlength="64" value=""/>
                        </div>
                    </div>
                </form>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-cancel" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary btn-save">添加</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade  sm-modal" id="modify-web-site">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header modal-header-primary">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">收录电影地址管理</h4>
            </div>
            <div class="modal-body" style="max-height:350px; overflow-y:auto">
                <form id="modifyForm" method="post" class="form-horizontal">
                    <input type="text" class="hidden" id="id"/>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">链接名称：</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control mgr-name" id='mgr-name'  maxlength="64"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">链接地址：</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control margin-top-15 mgr-url " id="mgr-url"  maxlength="64"/>
                        </div>

                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary btn-modify-save">添加</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade acct-role-module-box sm-modal" id="delete-web-site">
    <div class="modal-dialog">
        <div class="modal-content">
        </div>
    </div>
</div>

<div class="container" style="text-align: center">
    Copyright @2016-2017 宁波柯氏水果有限公司版权所有
</div>
<script src="../webapp/static/js/jquery-2.0.3.min.js"></script>
<script src="../webapp/static/js/bootstrap.min.js"></script>
<script src="../webapp/static/js/bootstrap-dialog.min.js"></script>
<script src="../webapp/static/js/bootstrap-pagy.min.js"></script>
<script src="../webapp/static/js/common.js"></script>
<script type="text/javascript">
    var root= getRootPath();
    var id = '';
    $(function () {
        var moduleCode = '03001';
        var curAcctName = "";


        $('[data-toggle="popover"]').popover();



        function initFun() {
            if (secure.find) {
                //dialog = BootstrapDialog.loading();
                demp.findWebSiteList(1);
                demp.findWebSitePage(1);

            }
            if (secure.add)
                $('button.add-btn').removeClass('hide');
            if (!secure.add)
                $('button.add-btn').remove();
        };

        $.findMenu(moduleCode, initFun,root);
        $('button.btn-save').on('click', function () {
            demp.save();
        })
        $('button.btn-cancel').on('click', function () {
            demp.showAddBox();
        })
        $('button.btn-search').on('click', function () {
            demp.findWebSiteList(1);
            demp.findWebSitePage(1);
        })

        $('button.btn-modify-save').click(function(){
            demp.update();
        })

        demp.findWebSiteList(1);
        demp.findWebSitePage(1);


    });
    var demp = {
        showAddBox: function () {
            $('input.acctName').val('');
            $('input.acctNick').val('');
            $('input.acctPass').val('');

        },
        save: function () {
            $.verify = true;
            var name = $.verifyForm('input.name');
            var url = $.verifyForm('input.url');
            if(!$.verify) return;

            var formData = new FormData($( "#addForm" )[0]);
            formData.append("name", name);
            formData.append("url", url);

            $.ajax({
                type: 'post',
                url: root + '/admin/web_site/save',
                data: formData,
                contentType: false,
                processData: false,
                success: function (data) {
                    if(data.head) {
                        $('#add-web-site').modal('hide');

                        demp.findWebSiteList(1);
                        demp.findWebSitePage(1);

                        new BootstrapDialog({
                            title: '系统提示',
                            message: data.body,
                            type: BootstrapDialog.TYPE_SUCCESS
                        }).open();
                    }else{
                        new BootstrapDialog({
                            title: '系统提示',
                            message: data.body,
                            type: BootstrapDialog.TYPE_DANGER
                        }).open();
                    }
                }
            })

        },
        update: function () {
            $.verify = true;
            var name = $.verifyForm('input.mgr-name');
            var url = $.verifyForm('input.mgr-url');
            if(!$.verify) return;

            var formData = new FormData($( "#modifyForm" )[0]);
            formData.append("name", name);
            formData.append("url", url);
            formData.append("id", document.getElementById('id').value);
            alert(document.getElementById('id').value);


            $.ajax({
                type: 'post',
                url: root + '/admin/web_site/update',
                data: formData,
                contentType: false,
                processData: false,
                success: function (data) {
                    if(data.head) {
                        $('#modify-web-site').modal('hide');

                        demp.findWebSiteList(1);
                        demp.findWebSitePage(1);

                        new BootstrapDialog({
                            title: '系统提示',
                            message: data.body,
                            type: BootstrapDialog.TYPE_SUCCESS
                        }).open();
                    }else{
                        new BootstrapDialog({
                            title: '系统提示',
                            message: data.body,
                            type: BootstrapDialog.TYPE_DANGER
                        }).open();
                    }
                }
            })

        },
        findWebSiteList: function (page) {
            var tbody = $('tbody.tbody-list').empty();
            var search = $('input.text-search').val();
            $.post(root+'/admin/web_site/findWebSiteList', {
                page: page,
                search: search

            }, function (data) {
                if (!$.isSuccess(data)) return;
                /* console.log(data.body);*/
                if (typeof data != 'object') {
                    data = $.parseJSON(data);
                }
                $.each(data.body, function (index, value) {
                    $('<tr></tr>')
                        .append($("<td></td>").append(value.id))
                        .append($("<td></td>").append(value.name))
                        .append($("<td></td>").append(value.url))
                        .append($("<td></td>").append(demp.getBtns(index, value)))
                        .appendTo(tbody);
                });
            })
        },
        findWebSitePage: function (page) {

            $("#pagination ul").empty();
            var search = $('input.text-search').val();
            $.post(root+'/admin/web_site/findWebSitePage', {
                page: page,
                search: search

            }, function (data) {
                console.log(data);
                if (typeof data != 'object') {
                    data = $.parseJSON(data);
                }
                data.body.nowPage = 1;

                $.setPage(data.body, demp.findWebSiteList);
            })
        },
        getBtns: function (index, value) {
            var btn = "";
            if(secure==null) return;
            //btn += secure.modify ? "<button type='button' class='btn btn-primary btn-xs'><span class='glyphicon glyphicon-pencil'></span>&nbsp;编辑</button>":"";
            btn += secure.modify ? "<button type='button' class='btn btn-success btn-xs'  onclick='demp.webSiteMgr(\"" + value.id + "\")'><span class='glyphicon glyphicon-star'></span>&nbsp;管理</button>":"";
            btn += "&nbsp;&nbsp;";
            btn += secure.del ?"<button type='button' class='btn btn-danger btn-xs' onclick='demp.hintDelete(\"" + value.id + "\")'><span class='glyphicon glyphicon-remove'></span>&nbsp;删除</button>":"";
            return btn;
        },
        webSiteMgr: function (id) {
            if (!id) return;
            var tbody = $('table.module-table').empty();

            $.getJSON(root+'/admin/web_site/getWebSiteById', {id: id}, function (data) {

                if(data.head) {

                    document.getElementById('mgr-name').value=data.body.name;
                    document.getElementById('mgr-url').value=data.body.url;
                    document.getElementById('id').value = id;

                    $('#modify-web-site').modal('show');
                }

            });
        },
        hintDelete: function (id) {
            if (!id) return;
            Dialog.confirm("请确定是否删除该记录?", function (result) {
                if (!result) return;
                dialog = Dialog.isSubmitted();
                $.getJSON(root + '/admin/web_site/deleteWebSite', {id: id}, function (data) {
                    dialog.close();
                    if (!$.isSuccess(data)) return;
                    Dialog.msg(data.body, BootstrapDialog.TYPE_SUCCESS);
                    demp.findWebSiteList(1);
                });
            });
        }

    }

</script>
</body>

</html>